<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LATIHAN BAHASA KOREA</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Arial, sans-serif;
      background: url('https://raw.githubusercontent.com/airnetcso/eps/main/image/bg1.jpg') no-repeat center center fixed;
      background-size: cover;
      position: relative;
      color: #e0e0e0;
    }
    body::before {
      content: '';
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.6);
      z-index: 0;
    }

    /* ================= SPLASH PREMIUM (perfect EPS: full page, no side padding) ================= */
    #splash {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100dvh;
      background: 
        linear-gradient(rgba(0,0,0,0.82), rgba(0,0,0,0.82)),
        url("https://raw.githubusercontent.com/airnetcso/eps/main/image/bg1.jpg") center/cover no-repeat;
      background-attachment: fixed;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      text-align: center;
      transition: opacity 1.3s ease;
      animation: fadeIn 1.2s ease-out;
    }

    @supports not (height: 100dvh) {
      #splash { height: 100vh; }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .splash-box {
      max-width: 560px;
      width: 100%;
      padding: 20px;
      box-sizing: border-box;
    }

    #splash h1 {
      font-size: 22px;
      font-weight: 800;
      line-height: 1.4;
      margin: 0 0 20px;
      text-shadow: 0 4px 12px rgba(0,0,0,0.9), 0 0 20px rgba(255, 107, 157, 0.4);
      letter-spacing: 0.5px;
    }
    #splash h1 b {
      color: #ff6b9d;
    }

    #splash-names {
      font-size: 11px;
      line-height: 1.7;
      opacity: 0.92;
      text-align: justify;
      text-justify: inter-word;
      hyphens: auto;
      word-break: break-word;
      text-shadow: 0 1px 3px rgba(0,0,0,0.7);
      max-width: 90%;
      margin: 0 auto;
      padding: 0 10px;
    }
    #splash-names span {
      white-space: normal;
    }
    #splash-names span::after {
      content: ". ";
      opacity: 0.7;
    }
    #splash-names span:last-child::after {
      content: " üî•";
    }

    @media (max-width: 480px) {
      .splash-box { padding: 15px 20px; }
      #splash h1 { font-size: 20px; }
      #splash-names { font-size: 12px; padding: 0 8px; }
    }

    /* ================= LOGIN PAGE (EPS style: hanya User ID + Kode Soal) ================= */
    #login-page {
      min-height: 100vh;
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      position: relative;
      z-index: 2;
      transition: opacity 0.8s ease;
      opacity: 0;
    }

    .login-container {
      width: 95%;
      max-width: 300px;
      padding: 35px 25px;
      text-align: center;
      background: rgba(40,40,40,0.92);
      border: 1px solid #666;
      border-radius: 8px;
      box-shadow: 0 14px 32px rgba(0,0,0,0.7);
      animation: fadeSlideUp 0.9s ease-out forwards;
      position: relative;
      z-index: 3;
      box-sizing: border-box;
    }

    @keyframes fadeSlideUp {
      from { opacity:0; transform:translateY(40px);}
      to { opacity:1; transform:translateY(0);}
    }

    .login-container h1 {
      color: #fff;
      font-size: 28px;
      margin: 0 0 24px;
      text-shadow: 0 2px 6px rgba(0,0,0,.7);
    }

    input {
      width: 100%;
      padding: 16px;
      margin: 12px 0;
      border: 1px solid #666;
      border-radius: 6px;
      background: #1e1e1e;
      color: #e0e0e0;
      font-size: 16px;
      box-sizing: border-box;
      transition: border-color 0.3s ease;
    }
    input::placeholder { color: #888; opacity:1; }
    input:focus { outline: none; border-color: #818cf8; }

    button {
      width: 100%;
      padding: 16px;
      margin: 16px 0 10px;
      border: none;
      border-radius: 6px;
      background: #ff6b9d;
      color: #fff;
      font-weight: bold;
      font-size: 17px;
      cursor: pointer;
      box-shadow: 0 6px 20px rgba(255,107,157,.5);
      transition: all 0.4s;
    }
    button:hover {
      background: #ff8ac1;
      transform: translateY(-5px) scale(1.05);
    }

    .copyright {
      margin-top: 35px;
      color: rgba(255,255,255,.8);
      font-size: 13px;
      text-shadow: 0 1px 4px rgba(0,0,0,.8);
    }

    /* ================= QUIZ PAGE & RESULT (tetap 100% style lama /latbakor) ================= */
    #quiz-page {
      display: none;
      min-height: 100vh;
      padding: 70px 0 80px;
      background: linear-gradient(#fdf6ec,#f7efe2);
      position: relative;
      z-index: 2;
      color: #333;
    }
    .header-fixed {
      position: fixed;
      top: 0; left: 0; right: 0;
      display: flex; justify-content: space-between; align-items: center;
      background: #fff; padding: 10px 15px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      z-index: 1000;
    }
    .timer, .submit-top {
      padding: 12px 24px; text-align: center; color: #fff; font-weight: bold; font-size: 16px; min-width: 110px; cursor: pointer;
    }
    .timer { background: #4caf50; }
    .submit-top { background: #f44336; }
    .container { max-width: 540px; margin: auto; height: calc(100vh - 150px); overflow-y: auto; padding: 0 15px; }

    .question-wrapper p,
    .option-item {
      color: #333 !important;
      font-weight: 500;
    }
    .option-item label {
      color: #333 !important;
      cursor: pointer;
    }
    .option-circle {
      color: #333;
      background: white;
    }
    .box-question {
      background: #fff3e0;
      padding: 20px;
      margin-top: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .question-wrapper { display: none; margin-bottom: 40px; }
    .question-wrapper.active { display: block; }
    .box-passage { padding: 0; margin-bottom: 20px; }
    .box-passage audio, .box-passage img { width: 100%; margin-top: 10px; display: block; }
    .box-passage audio { background: #e8d5b8; height: 48px; border-radius: 0 !important; }

    .option-item { display: flex; align-items: center; margin: 18px 0; font-size: 16px; }
    .option-item input { display: none; }
    .option-circle { width: 32px; height: 32px; border: 2px solid #333; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px; flex-shrink: 0; font-weight: bold; font-size: 15px; }
    .option-item input:checked + .option-circle { background: #bbdefb; border-color: #2196f3; color: #2196f3; }

    .nav-bottom {
      position: fixed; bottom: 0; left: 0; right: 0;
      display: flex; justify-content: space-between; align-items: center;
      background: #fff; padding: 10px 15px;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
    }
    .nav-bottom button {
      padding: 12px 24px; text-align: center; color: #fff; border: none; font-weight: bold; font-size: 16px; border-radius: 0; min-width: 110px; cursor: pointer;
    }
    #prev { background: #2196f3; }
    #next { background: #ff9800; }

    #result-page {
      display: none;
      max-width: 600px; margin: auto; padding: 20px 15px;
      position: relative; z-index: 2;
      color: #333;
    }
    .result-box { background: #fff; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-radius: 12px; }
    .wrong-item { margin-top: 20px; padding: 15px; background: #ffebee; border-left: 5px solid #f44336; border-radius: 8px; color: #333; }
    .correct { color: green; font-weight: bold; }
    .back-btn {
      margin-top: 30px; padding: 16px;
      background: #3f51b5; color: #fff; text-align: center; font-weight: bold; font-size: 17px;
      border-radius: 12px; cursor: pointer;
    }
  </style>
</head>
<body>

<!-- SPLASH PREMIUM (EPS perfect) -->
<div id="splash">
  <div class="splash-box">
    <h1>
      <b>Ïó¨Îü¨Î∂Ñ,</b> tetap semangat!<br><br>
      Kalian semua pasti lulus ujian EPS TOPIK, Aamiin ...
    </h1>
    <div id="splash-names">
      Uus. Hanarizka. Windi. Rismayayanti. Sita. Mila. Aini. Feinie. Hamdan. Heri. Fikrisurya. Mutiara. Wantika. Dini. Kaniarostayuni. Dikisetiawan. Aisyah. Rizka. Dinda. Zhafif. Siwon. Azizah. Yppsdi. Satria. Sultan. Aditya. Bima. Citra. Dewi. Eka. Fadli. Gita. Hafiz. Indah. Jihan. Kim Jihoon. Laras. Minji. Naufal. Putri. Qori. Raka. Sari. Taufik. Umair. Vina. Wahyu. Xena. Yanti. Zara. Arif. Bunga. Chandra. Dhani. Elina. Fajar. Galang. Hadi. Indra. Joko. Kurnia. Lukman. Maulana. Nanda üî•
    </div>
  </div>
</div>

<!-- LOGIN PAGE (EPS style: hanya User ID + Kode Soal) -->
<div id="login-page">
  <div class="login-container">
    <h1>LATIHAN SOAL</h1>
    <input id="userId" placeholder="User ID / ÏïÑÏù¥Îîî">
    <input id="kode" placeholder="Kode Soal / ÏãúÌóòÏΩîÎìú">
    <button id="btnLogin">LOGIN / Î°úÍ∑∏Ïù∏</button>
  </div>
  <div class="copyright">¬© 2026 Denzuka - Kim Jongun. All Rights Reserved.</div>
</div>

<!-- QUIZ PAGE (tetap style lama /latbakor) -->
<div id="quiz-page">
  <div class="header-fixed">
    <div class="submit-top" id="submitTop">SUBMIT</div>
    <div class="timer" id="timer">50:00</div>
  </div>
  <div class="container">
    <form id="quiz-form"></form>
  </div>
  <div class="nav-bottom">
    <button id="prev">PREV</button>
    <button id="next">NEXT</button>
  </div>
</div>

<!-- RESULT PAGE -->
<div id="result-page">
  <div class="result-box" id="resultBox"></div>
</div>

<script>
// Script disesuaikan untuk login User ID + Kode Soal saja
const SPREADSHEET_URL = "https://script.google.com/macros/s/AKfycbzxyVIlsyLswlfnQG618eeUZgN83dd2jfCjU0r7LsNHM3A6NNiibuCIb5e3CNs9J1vVhQ/exec";

const userIdToName = {
  "2026010001":"Uus","2026010072":"Hanarizka","2026010011":"Windi","2026010017":"Rismayayanti",
  "2026010015":"Sita","2026010036":"Mila","2026010023":"Aini","2026010048":"Feinie",
  "2026010009":"Hamdan","2026010010":"Heri","2026010031":"Fikrisurya","2026010062":"Mutiara",
  "2026010043":"Wantika","2026010014":"Dini","2026010015":"Kaniarostayuni","2026010016":"Dikisetiawan",
  "2026010064":"Aisyah","2026010018":"Rizka","2026010019":"Dinda","2026010020":"Zhafif",
  "2026010021":"Siwon","2026010022":"Azizah","2026010069":"Yppsdi","2026010024":"Satria",
  "2026010075":"Sultan"
};

const kodeMapping = {
  "b12345":"soal1.json","a09008":"soal2.json","sarewae":"test.json","maukimbap":"soal6.json",
  "urinara":"soal5.json","cincay":"soal_urinara.json"
};

const BASE = "https://raw.githubusercontent.com/airnetcso/latbakor/main/soal/";

let questions = [], answers = [], current = 0, time = 3000, interval;
let currentUser = "", currentKode = "";
let warned5min = false;
let warnedLast = false;

document.addEventListener("DOMContentLoaded", () => {
  const splash = document.getElementById("splash");
  const loginPage = document.getElementById("login-page");
  const quizPage = document.getElementById("quiz-page");
  const resultPage = document.getElementById("result-page");
  const btnLogin = document.getElementById("btnLogin");
  const submitTop = document.getElementById("submitTop");
  const quizForm = document.getElementById("quiz-form");
  const timerEl = document.getElementById("timer");
  const resultBox = document.getElementById("resultBox");

  setTimeout(() => {
    splash.style.opacity = "0";
    setTimeout(() => {
      splash.style.display = "none";
      loginPage.style.display = "flex";
      setTimeout(() => { loginPage.style.opacity = "1"; }, 100);
    }, 1300);
  }, 6000);

  btnLogin.onclick = () => {
    const userId = document.getElementById("userId").value.trim();
    const kode = document.getElementById("kode").value.trim().toLowerCase();
    const username = userIdToName[userId];

    if (!username) { alert("User ID tidak terdaftar"); return; }
    if (!kodeMapping[kode]) { alert("Kode soal salah"); return; }

    currentUser = username;
    currentKode = kode;

    loginPage.style.display = "none";
    quizPage.style.display = "block";
    loadSoal(kodeMapping[kode]);
    startTimer();
  };

  async function loadSoal(file) {
    let loaded = await (await fetch(BASE + file)).json();
    questions = loaded;
    answers = Array(questions.length).fill(null);
    quizForm.innerHTML = "";
    questions.forEach((q, i) => {
      quizForm.innerHTML += `
        <div class="question-wrapper">
          <div class="box-passage">
            ${q.audio ? `<audio controls src="${q.audio}"></audio>` : ""}
            ${q.image ? `<img src="${q.image}">` : ""}
          </div>
          <div class="box-question">
            <p><b>${i+1}.</b> ${q.question}</p>
            ${Object.entries(q.options).map(([k, v], idx) => `
              <label class="option-item">
                <input type="radio" name="q${i}" value="${k}">
                <span class="option-circle">${idx+1}</span> ${v}
              </label>
            `).join("")}
          </div>
        </div>`;
    });
    document.querySelectorAll("input[type=radio]").forEach(r => {
      r.onchange = () => answers[+r.name.slice(1)] = r.value;
    });
    show(0);
  }

  function show(n) {
    document.querySelectorAll("audio").forEach(a => { a.pause(); a.currentTime = 0; });
    document.querySelectorAll(".question-wrapper").forEach((q, i) => q.classList.toggle("active", i === n));
    current = n;

    if (current === questions.length - 1 && !warnedLast) {
      alert("Ini soal terakhir! Pastikan jawaban sudah benar ya!");
      warnedLast = true;
    }
  }

  document.getElementById("prev").onclick = () => current > 0 && show(current - 1);
  document.getElementById("next").onclick = () => current < questions.length - 1 && show(current + 1);

  submitTop.onclick = () => {
    const kosong = answers.findIndex(a => a === null);
    if (kosong !== -1) { 
      alert("Soal " + (kosong + 1) + " belum dijawab"); 
      show(kosong); 
      return; 
    }

    if (confirm("Semua soal sudah dijawab. Mau cek lagi atau langsung SUBMIT?")) {
      clearInterval(interval);
      quizPage.style.display = "none";
      resultPage.style.display = "block";
      let score = 0, html = "";
      questions.forEach((q, i) => {
        const benar = q.answer;
        if (answers[i] === benar) score += 4;
        else html += `<div class="wrong-item"><b>Soal ${i+1} salah</b><br>Jawaban benar: <span class="correct">${benar}</span></div>`;
      });
      const totalQuestions = questions.length;
      const percent = Math.round((score / (totalQuestions * 4)) * 100);
      const formData = new URLSearchParams({
        waktu: new Date().toLocaleString('id-ID', { timeZone: 'Asia/Jakarta' }),
        namaSiswa: currentUser || "Anonymous",
        code: currentKode || "Unknown",
        latihanSoal: `${score}/${totalQuestions * 4} (${percent}%)`,
        keterangan: html ? "Ada jawaban salah" : "Semua benar"
      });
      fetch(SPREADSHEET_URL, { method: "POST", mode: "no-cors", keepalive: true, body: formData });
      resultBox.innerHTML = `
        <h2>Nilai: ${score}</h2>
        ${html || "<p class='correct'>Semua jawaban benar üéâ</p>"}
        <div class="back-btn" onclick="location.reload()">KEMBALI</div>`;
    }
  };

  function startTimer() {
    interval = setInterval(() => {
      timerEl.textContent = String(Math.floor(time / 60)).padStart(2, "0") + ":" + String(time % 60).padStart(2, "0");

      if (time <= 300 && !warned5min) {
        alert("Waktu tinggal 5 menit! Segera selesaikan soal yang belum dijawab!");
        timerEl.style.background = "#f44336";
        warned5min = true;
      }

      if (--time < 0) submitTop.onclick();
    }, 1000);
  }
});
</script>
</body>
</html>
